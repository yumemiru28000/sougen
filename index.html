<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ËçâÂéü</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #87CEEB;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
            width: 100vw;
            height: 100vh;
        }

        #container {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }

        #background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #87CEEB;
        }

        #grassImage {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            display: block;
        }

        #characterCounter {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 12px 20px;
            border-radius: 20px;
            font-size: 18px;
            font-weight: bold;
            color: #2d5016;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 100;
            border: 3px solid #4a7c29;
        }

        .character {
            position: absolute;
            cursor: pointer;
            transition: transform 0.3s ease;
            z-index: 10;
        }

        .character img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            pointer-events: none;
        }

        .character:hover {
            transform: scale(1.1);
        }

        .character.flipped img {
            transform: scaleX(-1);
        }

        .emoji-float {
            position: absolute;
            font-size: 30px;
            pointer-events: none;
            z-index: 20;
            animation: floatUp 2s ease-out forwards;
        }

        @keyframes floatUp {
            0% {
                opacity: 1;
                transform: translateY(0) translateX(0);
            }
            100% {
                opacity: 0;
                transform: translateY(-150px) translateX(var(--sway));
            }
        }

        #overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        #detailCard {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #fff9e6 0%, #ffe6f0 100%);
            border-radius: 30px;
            padding: 40px;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            border: 5px solid #ffb6c1;
        }

        #closeBtn {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 40px;
            height: 40px;
            background: #ff6b9d;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }

        #closeBtn:hover {
            background: #ff4081;
            transform: rotate(90deg);
        }

        .detail-header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px dashed #ffb6c1;
            padding-bottom: 20px;
        }

        .detail-image {
            width: 150px;
            height: 150px;
            object-fit: contain;
            margin: 0 auto 20px;
            display: block;
            background: white;
            border-radius: 50%;
            padding: 15px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .detail-name {
            font-size: 36px;
            font-weight: bold;
            color: #ff6b9d;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 10px;
        }

        .detail-creator {
            font-size: 14px;
            color: #888;
            font-style: italic;
        }

        .detail-section {
            background: white;
            border-radius: 15px;
            padding: 15px 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            border-left: 5px solid #ffb6c1;
        }

        .detail-label {
            font-size: 14px;
            font-weight: bold;
            color: #ff6b9d;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .detail-value {
            font-size: 16px;
            color: #333;
            line-height: 1.6;
        }

        .message-card {
            background: linear-gradient(135deg, #fff 0%, #fffacd 100%);
            border-radius: 20px;
            padding: 25px;
            margin-top: 25px;
            border: 3px solid #ffd700;
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
            position: relative;
        }

        .message-card::before {
            content: "üíå";
            position: absolute;
            top: -20px;
            left: 20px;
            font-size: 40px;
        }

        .message-title {
            font-size: 20px;
            font-weight: bold;
            color: #ff6b9d;
            margin-bottom: 15px;
            text-align: center;
        }

        .message-text {
            font-size: 16px;
            color: #555;
            line-height: 1.8;
            white-space: pre-wrap;
        }

        .gif-overlay {
            position: absolute;
            pointer-events: none;
            z-index: 15;
        }

        .gif-overlay img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="background">
            <img id="grassImage" src="sibahu1.png" alt="ËçâÂéü">
        </div>
        <div id="characterCounter">0/0</div>
    </div>

    <div id="overlay">
        <div id="detailCard">
            <button id="closeBtn">√ó</button>
            <div id="detailContent"></div>
        </div>
    </div>

    <script>
        // ========== „Ç≠„É£„É©„ÇØ„Çø„Éº„Éá„Éº„Çø ==========
        const characters = [
            {
                name: "„ÅÜ„Å®„ÅÜ„Å®",
                image: "cara1.png",
                emoji: "‚ù§Ô∏è",
                movementType: 3,
                moveTime: 2,
                restTime: 3,
                areaType: 1,
                size: 25,
                comesOnClick: 1,
                gifUrl: "",
                gifDuration: 3,
                details: {
                    personality: "Áîò„Åà„ÇìÂùä",
                    size: "‰∏≠ÂûãÔºà50cmÔºâ",
                    ability: "È£õ„Å∂ÔºèÊµÆ„Åè",
                    likes: "„ÅÇ„Åü„Åü„Åã„ÅÑÈ£≤„ÅøÁâ©„ÇíÈ£≤„ÇÄ„Åì„Å®",
                    dislikes: "„Å´„Åé„ÇÑ„Åã„Å™Â†¥ÊâÄ„ÅØËêΩ„Å°ÁùÄ„Åã„Å™„ÅÑ„Åã„ÇâËã¶Êâã",
                    environment: "Èùô„Åã„Å™„ÅäÈÉ®Â±ã„ÅÆ„Åô„Åø„Å£„Åì",
                    features: "ÊúàÔºëÂõû„ÅØÂ∫É„ÅÑÂÖ¨Âúí„Å´Êï£Ê≠©„Çí„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô",
                    creator: "ÂõõÂ≠£",
                    message: "„ÅäË™ïÁîüÊó•„Åä„ÇÅ„Åß„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ„Åô„Å¶„Åç„Å™‰∏ÄÂπ¥„Å´„Å™„Çä„Åæ„Åô„Çà„ÅÜ„Å´"
                }
            },
            {
                name: "„Åô„Åø„Çå",
                image: "cara2.png",
                emoji: "‚Ä¶",
                movementType: 2,
                moveTime: 4,
                restTime: 2,
                areaType: 2,
                size: 20,
                comesOnClick: 1,
                gifUrl: "",
                gifDuration: 2,
                details: {
                    personality: "„ÇØ„Éº„É´",
                    size: "Â∞èÂûãÔºà30cmÔºâ",
                    ability: "Áâ©„ÇíÈ£õ„Å∞„Åõ„Çã",
                    likes: "„Éñ„É´„Éº„Éô„É™„Éº„ÅÆ„Çà„ÅÜ„Å™ÁîòÈÖ∏„Å£„Å±„ÅÑÊûúÁâ©„ÇíË≤∞„ÅÜ„Åì„Å®",
                    dislikes: "Êßã„Çè„ÇåÈÅé„Åé„Çã„Åì„Å®",
                    environment: "Êó•Âêë„Åº„Å£„Åì„Åó„ÇÑ„Åô„ÅÑÂ±ãÂ§ñ",
                    features: "‰∏ÄÊó•‰∏ÄÂõûÊó•Âêë„Åº„Å£„Åì„Çí„Åó„Å¶‰∏ã„Åï„ÅÑ",
                    creator: "„Ç∑„É≠",
                    message: "Tachioooo„Åï„Çì„ÅäË™ïÁîüÊó•„Åä„ÇÅ„Åß„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅË≤¥Êñπ„Å´„Å®„Å£„Å¶„Çà„Åç‰∏ÄÂπ¥„Å´„Å™„Çä„Åæ„Åô„Çà„ÅÜ„Å´ÔºÅ"
                }
            },
            {
                name: "„Åµ„Çè„ÇÄ„Å´",
                image: "character3.png",
                emoji: "üå∏",
                movementType: 1,
                moveTime: 0,
                restTime: 0,
                areaType: 3,
                size: 15,
                comesOnClick: 0,
                gifUrl: "",
                gifDuration: 3,
                details: {
                    personality: "„ÇØ„Éº„É´",
                    size: "Â∞èÂûãÔºà35cmÔºâ",
                    ability: "„Åä„ÅÑ„Åó„ÅÑ„ÇÇ„ÅÆ„Çí‰Ωú„Çã",
                    likes: "„ÅäËå∂„Å®„Åä„ÇÑ„Å§",
                    dislikes: "ÊπøÊ∞ó",
                    environment: "„Åè„Å§„Çç„Åé„Çπ„Éö„Éº„Çπ",
                    features: "ÈÅ©Â∫¶„Å´ÈÅãÂãï„Åï„Åõ„Åæ„Åó„Çá„ÅÜ",
                    creator: "myon",
                    message: "„ÅäË™ïÁîüÊó•„Åä„ÇÅ„Åß„Å®„ÅÜÔºÅ"
                }
            },
            {
                name: "„Å°„Éº„Åã„Åæ",
                image: "character4.png",
                emoji: "ü§ç",
                movementType: 3,
                moveTime: 3,
                restTime: 4,
                areaType: 1,
                size: 30,
                comesOnClick: 1,
                gifUrl: "",
                gifDuration: 2,
                details: {
                    personality: "„Éû„Ç§„Éö„Éº„Çπ",
                    size: "Êâã„ÅÆ„Å≤„Çâ„Çµ„Ç§„Ç∫Ôºà10cmÔºâ",
                    ability: "‰∫∫„ÇíÁ¨ëÈ°î„Å´„Åô„Çã",
                    likes: "Á¨ë„Å£„Å¶„Åè„Çå„Çã„Åì„Å®",
                    dislikes: "",
                    environment: "Â§â„Å™Â†¥ÊâÄ„ÅåÂ•Ω„Åç(ÈöÖ„Å£„Åì„Å®„Åã„Åù„ÅìÂÖ•„Çã„ÅÆÔºü„Åø„Åü„ÅÑ„Å™ÈöôÈñì)",
                    features: "",
                    creator: "ÔæÜÔΩ∑Ôæûüçô",
                    message: "„ÅäË™ïÁîüÊó•„Åä„ÇÅ„Åß„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åôüôå‚ú®"
                }
            },
            {
                name: "„Éî„Éº„Çπ",
                image: "cara5.png",
                emoji: "üç∞",
                movementType: 2,
                moveTime: 5,
                restTime: 3,
                areaType: 2,
                size: 35,
                comesOnClick: 1,
                gifUrl: "",
                gifDuration: 4,
                details: {
                    personality: "„Ç≠„Ç∂",
                    size: "Â§ßÂûãÔºà120cmÔºâ",
                    ability: "„Åä„ÅÑ„Åó„ÅÑ„ÇÇ„ÅÆ„Çí‰Ωú„Çã„Åì„Å®„Å®Â§âË∫´„Åß„Åç„Çã",
                    likes: "„ÅÑ„Å°„Åî„ÇíÈ£æ„Å£„Å¶„ÇÇ„Çâ„ÅÜ„Åì„Å®",
                    dislikes: "‰∏Ä‰∫∫„Åº„Å£„Å°",
                    environment: "„É°„É´„Éò„É≥",
                    features: "„Ç±„Éº„Ç≠„É¢„ÉÅ„Éº„Éï„ÅÆ„Å§„ÇÇ„Çä„ÅßÂõûÁ≠î„Åó„Åæ„Åó„Åü„ÄÇ„Åã„Çè„ÅÑ„ÅÑ„ÇÇ„ÅÆ„ÅåÂ•Ω„Åç„ÄÇ",
                    creator: "ÂåøÂêç„Åï„Çì",
                    message: "Tachioooo„Åï„Çì„ÅäË™ïÁîüÊó•„Åä„ÇÅ„Åß„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôüéÇ"
                }
            }
        ];

        // ========== „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞ ==========
        let activeCharacters = [];
        let grassBounds = null;
        let clickCount = 0;
        let lastClickTime = 0;

        // ========== ÂàùÊúüÂåñ ==========
        window.addEventListener('load', () => {
            const grassImage = document.getElementById('grassImage');
            grassImage.addEventListener('load', () => {
                calculateGrassBounds();
                selectRandomCharacters();
                startCharacterRotation();
            });

            if (grassImage.complete) {
                calculateGrassBounds();
                selectRandomCharacters();
                startCharacterRotation();
            }
        });

        window.addEventListener('resize', () => {
            calculateGrassBounds();
        });

        // ========== ËçâÂéü„ÅÆÂ¢ÉÁïåË®àÁÆó ==========
        function calculateGrassBounds() {
            const grassImage = document.getElementById('grassImage');
            const rect = grassImage.getBoundingClientRect();
            grassBounds = {
                left: rect.left,
                top: rect.top,
                width: rect.width,
                height: rect.height,
                right: rect.right,
                bottom: rect.bottom
            };
        }

        // ========== „É©„É≥„ÉÄ„É†„Ç≠„É£„É©„ÇØ„Çø„ÉºÈÅ∏Êäû ==========
        function selectRandomCharacters() {
            removeAllCharacters();
            
            const shuffled = [...characters].sort(() => Math.random() - 0.5);
            const selected = shuffled.slice(0, Math.min(3, characters.length));
            
            selected.forEach(char => {
                createCharacter(char);
            });
            
            updateCounter();
        }

        // ========== „Ç≠„É£„É©„ÇØ„Çø„Éº‰ΩúÊàê ==========
        function createCharacter(charData) {
            const charElement = document.createElement('div');
            charElement.className = 'character';
            
            const size = (charData.size / 50) * (window.innerHeight / 2);
            charElement.style.width = `${size}px`;
            charElement.style.height = `${size}px`;
            
            const img = document.createElement('img');
            img.src = charData.image;
            charElement.appendChild(img);
            
            const startPos = getRandomPositionInArea(charData.areaType, size);
            charElement.style.left = `${startPos.x}px`;
            charElement.style.top = `${startPos.y}px`;
            
            document.getElementById('container').appendChild(charElement);
            
            const charState = {
                element: charElement,
                data: charData,
                x: startPos.x,
                y: startPos.y,
                size: size,
                targetX: startPos.x,
                targetY: startPos.y,
                isMoving: false,
                isFlipped: false,
                moveTimer: null,
                gifTimer: null,
                lastGifTime: Date.now()
            };
            
            activeCharacters.push(charState);
            
            charElement.addEventListener('click', (e) => handleCharacterClick(e, charState));
            charElement.addEventListener('dblclick', (e) => handleCharacterDoubleClick(e, charState));
            
            startCharacterBehavior(charState);
            if (charData.gifUrl) {
                startGifBehavior(charState);
            }
        }

        // ========== „Ç®„É™„Ç¢„Çø„Ç§„Éó„Å´„Çà„Çã‰ΩçÁΩÆÂèñÂæó ==========
        function getRandomPositionInArea(areaType, size) {
            if (!grassBounds) return { x: 100, y: 100 };
            
            const bounds = getAreaBounds(areaType);
            
            const x = bounds.left + Math.random() * (bounds.width - size);
            const y = bounds.top + Math.random() * (bounds.height - size);
            
            return { x, y };
        }

        function getAreaBounds(areaType) {
            if (!grassBounds) return { left: 0, top: 0, width: 100, height: 100 };
            
            const { left, top, width, height } = grassBounds;
            
            switch(areaType) {
                case 1: // ‰∏ãÈÉ®1/3
                    return {
                        left,
                        top: top + height * 2/3,
                        width,
                        height: height / 3
                    };
                case 2: // ‰∏≠Â§Æ1/3
                    return {
                        left,
                        top: top + height / 3,
                        width,
                        height: height / 3
                    };
                case 3: // ‰∏äÈÉ®1/3
                    return {
                        left,
                        top,
                        width,
                        height: height / 3
                    };
                default:
                    return { left, top, width, height };
            }
        }

        // ========== „Ç≠„É£„É©„ÇØ„Çø„Éº„ÅÆÂãï„Åç ==========
        function startCharacterBehavior(charState) {
            const { data } = charState;
            
            if (data.movementType === 1) return;
            
            function loop() {
                const shouldMove = Math.random() > 0.5;
                
                if (shouldMove) {
                    const duration = (data.moveTime + (Math.random() - 0.5) * data.moveTime * 0.5) * 1000;
                    moveCharacter(charState, data.movementType);
                    charState.moveTimer = setTimeout(loop, duration);
                } else {
                    const duration = (data.restTime + (Math.random() - 0.5) * data.restTime * 0.5) * 1000;
                    charState.isMoving = false;
                    charState.moveTimer = setTimeout(loop, duration);
                }
            }
            
            loop();
        }

        function moveCharacter(charState, movementType) {
            const bounds = getAreaBounds(charState.data.areaType);
            
            const targetX = bounds.left + Math.random() * (bounds.width - charState.size);
            const targetY = bounds.top + Math.random() * (bounds.height - charState.size);
            
            charState.targetX = targetX;
            charState.targetY = targetY;
            charState.isMoving = true;
            
            const deltaX = targetX - charState.x;
            if (deltaX > 0 && !charState.isFlipped) {
                charState.element.classList.add('flipped');
                charState.isFlipped = true;
            } else if (deltaX < 0 && charState.isFlipped) {
                charState.element.classList.remove('flipped');
                charState.isFlipped = false;
            }
            
            if (movementType === 2) {
                slideCharacter(charState);
            } else if (movementType === 3 || movementType === 4) {
                hopCharacter(charState);
            }
        }

        function slideCharacter(charState) {
            const duration = 1000 + Math.random() * 1000;
            const startTime = Date.now();
            const startX = charState.x;
            const startY = charState.y;
            
            function animate() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                const easeProgress = progress < 0.5 
                    ? 2 * progress * progress 
                    : -1 + (4 - 2 * progress) * progress;
                
                charState.x = startX + (charState.targetX - startX) * easeProgress;
                charState.y = startY + (charState.targetY - startY) * easeProgress;
                
                charState.element.style.left = `${charState.x}px`;
                charState.element.style.top = `${charState.y}px`;
                
                if (progress < 1) {
                    requestAnimationFrame(animate);
                }
            }
            
            animate();
        }

        function hopCharacter(charState) {
            const hops = 3 + Math.floor(Math.random() * 3);
            let currentHop = 0;
            
            const deltaX = (charState.targetX - charState.x) / hops;
            const deltaY = (charState.targetY - charState.y) / hops;
            
            function hop() {
                if (currentHop >= hops) return;
                
                const hopDuration = 300 + Math.random() * 200;
                const startTime = Date.now();
                const startX = charState.x;
                const startY = charState.y;
                const endX = startX + deltaX;
                const endY = startY + deltaY;
                
                function animate() {
                    const elapsed = Date.now() - startTime;
                    const progress = Math.min(elapsed / hopDuration, 1);
                    
                    charState.x = startX + (endX - startX) * progress;
                    charState.y = startY + (endY - startY) * progress;
                    
                    const hopHeight = Math.sin(progress * Math.PI) * 30;
                    
                    charState.element.style.left = `${charState.x}px`;
                    charState.element.style.top = `${charState.y - hopHeight}px`;
                    
                    if (progress < 1) {
                        requestAnimationFrame(animate);
                    } else {
                        currentHop++;
                        setTimeout(hop, 100 + Math.random() * 100);
                    }
                }
                
                animate();
            }
            
            hop();
        }

        // ========== GIF„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ ==========
        function startGifBehavior(charState) {
            function scheduleGif() {
                const delay = 10000 + Math.random() * 20000;
                charState.gifTimer = setTimeout(() => {
                    showGif(charState);
                    scheduleGif();
                }, delay);
            }
            
            scheduleGif();
        }

        function showGif(charState) {
            if (!charState.data.gifUrl) return;
            
            const gifElement = document.createElement('div');
            gifElement.className = 'gif-overlay';
            gifElement.style.left = charState.element.style.left;
            gifElement.style.top = charState.element.style.top;
            gifElement.style.width = `${charState.size}px`;
            gifElement.style.height = `${charState.size}px`;
            
            const img = document.createElement('img');
            img.src = charState.data.gifUrl;
            gifElement.appendChild(img);
            
            document.getElementById('container').appendChild(gifElement);
            
            setTimeout(() => {
                gifElement.remove();
            }, charState.data.gifDuration * 1000);
        }

        // ========== „ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà ==========
        function handleCharacterClick(e, charState) {
            e.stopPropagation();
            
            const now = Date.now();
            if (now - lastClickTime < 300) return;
            lastClickTime = now;
            
            setTimeout(() => {
                if (clickCount === 1) {
                    showEmojis(charState);
                }
                clickCount = 0;
            }, 300);
            
            clickCount++;
        }

        function handleCharacterDoubleClick(e, charState) {
            e.stopPropagation();
            clickCount = 0;
            showCharacterDetails(charState.data);
        }

        function showEmojis(charState) {
            const rect = charState.element.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            
            for (let i = 0; i < 3; i++) {
                setTimeout(() => {
                    const emoji = document.createElement('div');
                    emoji.className = 'emoji-float';
                    emoji.textContent = charState.data.emoji;
                    emoji.style.left = `${centerX}px`;
                    emoji.style.top = `${centerY}px`;
                    
                    const sway = (Math.random() - 0.5) * 100;
                    emoji.style.setProperty('--sway', `${sway}px`);
                    
                    document.body.appendChild(emoji);
                    
                    setTimeout(() => emoji.remove(), 2000);
                }, i * 200);
            }
        }

        // ========== Ë©≥Á¥∞Ë°®Á§∫ ==========
        function showCharacterDetails(charData) {
            const detailContent = document.getElementById('detailContent');
            const details = charData.details;
            
            let html = `
                <div class="detail-header">
                    <img src="${charData.image}" alt="${charData.name}" class="detail-image">
                    <div class="detail-name">${charData.name}</div>
                    ${details.creator ? `<div class="detail-creator">Created by ${details.creator}</div>` : ''}
                </div>
            `;
            
            const fields = [
                { key: 'personality', label: 'ÊÄßÊ†º' },
                { key: 'size', label: '„Çµ„Ç§„Ç∫' },
                { key: 'ability', label: 'ÁâπÊäÄ„ÉªËÉΩÂäõ' },
                { key: 'likes', label: 'Âñú„Å∂„Åì„Å®' },
                { key: 'dislikes', label: 'Ëã¶Êâã„Å™„ÇÇ„ÅÆ' },
                { key: 'environment', label: 'Êé®Â•®Áí∞Â¢É' },
                { key: 'features', label: 'ÁâπÂæ¥' }
            ];
            
            fields.forEach(field => {
                if (details[field.key]) {
                    html += `
                        <div class="detail-section">
                            <div class="detail-label">${field.label}</div>
                            <div class="detail-value">${details[field.key]}</div>
                        </div>
                    `;
                }
            });
            
            if (details.message) {
                html += `
                    <div class="message-card">
                        <div class="message-title">„É°„ÉÉ„Çª„Éº„Ç∏„Ç´„Éº„Éâ</div>
                        <div class="message-text">${details.message}</div>
                    </div>
                `;
            }
            
            detailContent.innerHTML = html;
            document.getElementById('overlay').style.display = 'block';
        }

        document.getElementById('closeBtn').addEventListener('click', () => {
            document.getElementById('overlay').style.display = 'none';
        });

        document.getElementById('overlay').addEventListener('click', (e) => {
            if (e.target === document.getElementById('overlay')) {
                document.getElementById('overlay').style.display = 'none';
            }
        });

        // ========== ËÉåÊôØ„ÇØ„É™„ÉÉ„ÇØ ==========
        document.getElementById('container').addEventListener('click', (e) => {
            if (e.target.closest('.character')) return;
            
            const clickableChars = activeCharacters.filter(c => c.data.comesOnClick === 1);
            if (clickableChars.length === 0) return;
            
            const randomChar = clickableChars[Math.floor(Math.random() * clickableChars.length)];
            
            randomChar.targetX = e.clientX - randomChar.size / 2;
            randomChar.targetY = e.clientY - randomChar.size / 2;
            
            const bounds = getAreaBounds(randomChar.data.areaType);
            randomChar.targetX = Math.max(bounds.left, Math.min(randomChar.targetX, bounds.left + bounds.width - randomChar.size));
            randomChar.targetY = Math.max(bounds.top, Math.min(randomChar.targetY, bounds.top + bounds.height - randomChar.size));
            
            slideCharacter(randomChar);
        });

        // ========== „Ç´„Ç¶„É≥„Çø„ÉºÊõ¥Êñ∞ ==========
        function updateCounter() {
            const displayed = activeCharacters.length;
            const total = characters.length;
            document.getElementById('characterCounter').textContent = `${displayed}/${total}`;
        }

        // ========== „Ç≠„É£„É©„ÇØ„Çø„Éº„É≠„Éº„ÉÜ„Éº„Ç∑„Éß„É≥ ==========
        function startCharacterRotation() {
            setInterval(() => {
                selectRandomCharacters();
            }, 5 * 60 * 1000);
        }

        // ========== ÂÖ®„Ç≠„É£„É©„ÇØ„Çø„ÉºÂâäÈô§ ==========
        function removeAllCharacters() {
            activeCharacters.forEach(char => {
                if (char.moveTimer) clearTimeout(char.moveTimer);
                if (char.gifTimer) clearTimeout(char.gifTimer);
                char.element.remove();
            });
            activeCharacters = [];
        }
    </script>
</body>
</html>
